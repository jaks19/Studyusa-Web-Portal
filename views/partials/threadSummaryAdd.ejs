<div style='width: 100%; border: 0px; background:#F1F1FA;'>
    <div align='center'style='padding: 0; margin: 0; border: 0px;'>
    
        <div class='container' style='background:#0084b4; border-radius: 25px; margin-left:-30px; color: white; width: 100%; border-bottom: solid 1px #E0F0F7; float:left;'> 
        <h5 style='margin-left:-35px;'> Thread Info </h5>
        </div>
        
        <div class='container' style='background:#FFFFFF; width: 80%; border-bottom: solid 1px #E0F0F7; float:left;'> 
        <h5> Name: <%=sub['title']%></h5>
        </div>
        
        <div class='container' style='background:#FFFFFF; width: 80%; border-bottom: solid 1px #E0F0F7; float:left;'> 
        <h5> Folder: <%=sub['folder']%></h5>
        </div>
        
        <div class='container' style='background:#FFFFFF; width: 80%; border-bottom: solid 1px #E0F0F7; float:left;'> 
        <% var d = new Date(sub['date']); %>
        <h5> Date: <%= d.getMonth() %>/<%= d.getDate() %>/<%= d.getFullYear() %> </h5>
        </div>
    
    
        <div style='width: 100%; float:left; '> 
        <h5 align='center'> <br /> <br /> <br /> <br /> <br /></h5>
        </div>
        
        <div class='container' style='background:#0084b4;  border-radius: 25px; margin-left:-30px;color: white; width: 100%; border-bottom: solid 1px #E0F0F7; float:left;'> 
        <h5> Upload an Updated Document </h5>
        </div>
        
        <div class='container' style='width: 90%; border-bottom: solid 1px #E0F0F7; float:left;'> 
        <br />
            <form action='/index/<%=client.username%>/submit/<%=sub['_id']%>/adds' method='POST' enctype='multipart/form-data'>
                <input type="file" class="form-control" name='doc' id='doc' style='width:80%;' required> <br />
                <button type="submit" class="btn btn-xs btn-info">Add</button> 
            </form>
        </div>
    
    </div>
</div>

<script>
(() => {
  document.getElementById('doc').onchange = () => {
    let file = document.getElementById('doc').files[0];
    if(file == null){ return }
    getSignedRequest(file);
};
})();
    
function getSignedRequest(file){
  const xhr = new XMLHttpRequest();
  xhr.open('GET', '/index/s3/getSignature/' + `?file-name=${file.name}&file-type=${file.type}`);
  xhr.onreadystatechange = () => {
    if(xhr.readyState === 4){
      if(xhr.status === 200){
        const response = JSON.parse(xhr.responseText);
        uploadFile(file, response.signedRequest, response.url);
      }
      else{
        alert('Could not get signed URL.');
      }
    }
  };
  xhr.send();
}

function uploadFile(file, signedRequest, url){
console.log(signedRequest);
console.log('uuuuuu', url);
  const xhr = new XMLHttpRequest();
  xhr.open('PUT', signedRequest);
  xhr.onreadystatechange = () => {
    if(xhr.readyState === 4){
      if(xhr.status === 200){
        console.log('uploaded!');
      }
      else{
        alert('Could not upload file.');
      }
    }
  };
  xhr.send(file);
}
</script>